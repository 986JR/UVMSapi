<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Colleges | UDOM Vendor Management System</title>
    <link rel="stylesheet" href="css/vendor-styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
<!-- Sidebar -->
<div class="sidebar">
    <div class="sidebar-header"><h3>UVMS</h3></div>
    <nav class="sidebar-nav">
        <a href="dashboard.html"><i class="fas fa-tachometer-alt"></i> Dashboard</a>
        <a href="colleges.html" class="active"><i class="fas fa-university"></i> Tenders</a>
        <a href="applications.html"><i class="fas fa-clipboard-list"></i> Applications</a>
        <a href="licenses.html"><i class="fas fa-certificate"></i> Licenses</a>
        <a href="contracts.html"><i class="fas fa-file-signature"></i> Contracts</a>
        <a href="policies.html"><i class="fas fa-book"></i> Policies</a>
        <a href="notifications.html"><i class="fas fa-bell"></i> Notifications</a>
        <a href="../../index.html"><i class="fas fa-sign-out-alt"></i> Logout</a>
    </nav>
</div>

<!-- Top Navigation -->
<nav class="navbar">
    <button class="mobile-menu-toggle"><i class="fas fa-bars"></i></button>
    <div class="navbar-brand">Tenders</div>
    <div class="navbar-user">
        <div class="user-avatar" id="userAvatar">JD</div>
        <span id="userName">John Doe</span>
    </div>
</nav>

<!-- Main Content -->
<div class="main-content">
    <div class="grid grid-2" id="collegesContainer"></div>
</div>

<script>
    const apiBase = "https://uvmsapiv1.onrender.com/api";
    const token = localStorage.getItem("jwtToken");

    // Fetch vendor info
    async function loadUser() {
        try {
            const res = await fetch(`${apiBase}/vendors/dashboard`, {
                headers: { "Authorization": "Bearer " + token }
            });
            const user = await res.json();
            document.getElementById("userName").textContent = user.firstName + " " + user.lastName;
            document.getElementById("userAvatar").textContent = (user.firstName[0] + user.lastName[0]).toUpperCase();
        } catch (e) { console.error(e); }
    }

    // Fetch colleges and tenders
    async function loadCollegesAndTenders() {
        try {
            const [collegesRes, tendersRes] = await Promise.all([
                fetch(`${apiBase}/colleges`),
                fetch(`${apiBase}/tenders`)
            ]);
            const colleges = await collegesRes.json();
            const tenders = await tendersRes.json();

            const container = document.getElementById("collegesContainer");
            container.innerHTML = "";

            tenders.forEach(tender => {
                const college = colleges.find(c => c.college_id === tender.college);
                if (!college) return;

                // status badge
                let statusClass = "badge-secondary";
                if (tender.status === "ACTIVE") statusClass = "badge-success";
                if (tender.status === "EXPIRED") statusClass = "badge-danger";
                if (tender.status === "PENDING") statusClass = "badge-warning";
                if (tender.status === "REJECTED") statusClass = "badge-dark";

                const card = document.createElement("div");
                card.className = "card college-card";
                card.innerHTML = `
            <div class="card-body">
              <div class="flex flex-between align-center mb-2">
                <div>
                  <h4 style="margin:0;color:var(--uvms-blue-primary);">${college.college_name}</h4>
                  <p style="margin:5px 0;color:var(--uvms-text-secondary-light);font-size:0.9em;">
                    <strong>${tender.title}</strong>
                  </p>
                </div>
                <span class="badge ${statusClass}">${tender.status}</span>
              </div>
              <p style="margin:10px 0;color:var(--uvms-text-secondary-light);">${college.description || "No description"}</p>
              <div class="alert alert-info" style="margin-bottom:15px;">
                <i class="fa fa-map-pin"></i> <strong>Location: </strong> UDOM
              </div>
              <div class="flex flex-between align-center">
                <small style="color:var(--uvms-text-secondary-light);">
                  <i class="fas fa-building"></i> Multiple departments available
                </small>
                <button class="btn btn-primary" onclick="viewDetails(${tender.tender_id}, ${college.college_id})">
                  <i class="fas fa-eye"></i> View Tenders
                </button>
              </div>
            </div>`;
                container.appendChild(card);
            });
        } catch (e) { console.error(e); }
    }

    function viewDetails(tenderId, collegeId) {
        window.location.href = `tender-details.html?tenderId=${tenderId}&collegeId=${collegeId}`;
    }

    loadUser();
    loadCollegesAndTenders();
</script>
</body>
</html>
